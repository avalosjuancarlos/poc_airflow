name: CD - Deploy

on:
  push:
    branches: [ main ]
    paths-ignore:
      - 'docs/**'
      - '*.md'
      - 'README.md'
      - '**/README.md'
    tags:
      - 'v*'
    # Note: paths-ignore also applies to tags. 
    # If you need tags to always deploy regardless of changed files,
    # consider creating a separate workflow for tag deployments.

jobs:
  deploy-dev:
    name: Deploy to Development
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3
    
    - name: Log deployment
      run: |
        echo "Deploying to Development environment"
        echo "Commit: ${{ github.sha }}"
        echo "Branch: ${{ github.ref_name }}"
    
    # Add your deployment steps here
    # For example: deploy to cloud, update containers, etc.
    
    - name: Deployment summary
      run: |
        echo "âœ… Deployment to Development completed"
  
  deploy-prod:
    name: Deploy to Production
    runs-on: ubuntu-latest
    if: startsWith(github.ref, 'refs/tags/v')
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Extract version
      id: version
      run: |
        echo "VERSION=${GITHUB_REF#refs/tags/v}" >> $GITHUB_OUTPUT
    
    - name: Log deployment
      run: |
        echo "Deploying version ${{ steps.version.outputs.VERSION }} to Production"
        echo "Tag: ${{ github.ref }}"
    
    # Add your production deployment steps here
    
    - name: Create GitHub Release
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: ${{ github.ref }}
        release_name: Release ${{ steps.version.outputs.VERSION }}
        body: |
          ## Changes in this Release
          
          See [CHANGELOG](CHANGELOG.md) for details.
          
          ## Deployment
          
          - Environment: Production
          - Version: ${{ steps.version.outputs.VERSION }}
          - Deployed at: ${{ github.event.head_commit.timestamp }}
        draft: false
        prerelease: false

